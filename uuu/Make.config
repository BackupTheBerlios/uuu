# $Header: /home/xubuntu/berlios_backup/github/tmp-cvs/uuu/Repository/uuu/Make.config,v 1.7 2003/11/07 20:55:38 bitglue Exp $
#
# common configuration for makefiles
#
# This file is included by every makefile in the Uuu build system.


#
# Interesting options concerning the operation of the build system
#


# set this to on to see the commands being run
VERBOSE=off
COLOR=on

AS=nasm
AS_ELF=nasm -f elf
AS_BIN=nasm -f bin
ASFLAGS=-I $(UUUROOT)/include -p $(UUUROOT)/include/macros.inc
export AS AS_ELF AS_BIN ASFLAGS

MKUDBFS=mkudbfs
MKUBBFSFLAGS=
export MKUDBFS MKUDBFSFLAGS

UDB_INSTBOOT = udb-instboot
UDB_INSTBOOT_FLAGS =
export UDB_INSBOOT UDB_INSBOOT_FLAGS

MKUUUBIMAGE = mkuuubimage
export MKUUUBIMAGE


# flags used to link stage2 with zlib. If you can't run the "boot" command,
# it's likely because you are linking with a zlib that is not compatible with
# the target machine. If this is the case, it's very easy to build zlib from
# source. After you have built it, change ZLIB_LDFLAGS to simply the full path
# to libz.a that zlib creates.

ZLIB_LDFLAGS = -L/usr/lib -lz
# ZLIB_LDFLAGS = /home/uuuuser/zlib-1.1.4/libz.a
export ZLIB_LDFLAGS

ARCH=x86
export ARCH


#
# Interesting options concerning the operation of Uuu at runtime
#


# This determines the type of boot console to be used. It may be either
# "textual" or "graphical" (default). If you have an LCD that doesn't like the
# anemic VGA video modes, this can be very handy. It also makes things
# considerably smaller.

BOOT_CONSOLE = textual


ifeq ($(VERBOSE),on)
  echo=@:
else
  echo=echo
  .SILENT:
endif

ifeq ($(COLOR),on)
entering=$(echo)	"[01;34mentering[00m"
assembling=$(echo)	"  [01;32massembling[00m"
generating=$(echo)	"  [01;32mgenerating[00m"
compressing=$(echo)	"  [01;32mcompressing[00m"
linking=$(echo)		"  [01;32mlinking[00m"
else
entering=$(echo)	"entering"
assembling=$(echo)	"  assembling"
generating=$(echo)	"  generating"
compressing=$(echo)	"  compressing"
linking=$(echo)		"  linking"
endif

%.bin: %.asm
	$(assembling) '$<  >  $@'
	$(AS_BIN) -o $@ $(ASFLAGS) -- $<

%.o: %.asm
	$(assembling) '$<  >  $@'
	$(AS_ELF) -o $@ $(ASFLAGS) -- $<

%.d: %.asm
	set -e
	$(AS) -M $(ASFLAGS) $< | sed 's/\($*\)\s*:/\1.bin \1.o $@ : /g' > $@
	[ -s $@ ] || rm -f $@

basic-clean:
	rm -f *.d

# vim: syn=make
